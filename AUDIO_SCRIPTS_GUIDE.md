# Audio Scripts Guide

This guide explains how to create scripts for your escape game storyline and generate audio files using ElevenLabs.

## Overview

The audio scripts system allows you to:
- Create and manage dialogue scripts for your game
- Generate high-quality audio using ElevenLabs text-to-speech
- Organize scripts by storyline chapters
- Support multiple types: voice messages, phone calls, narration, and dialogue

## Setup

### 1. Get ElevenLabs API Key

1. Sign up for an account at [elevenlabs.io](https://elevenlabs.io)
2. Navigate to your profile settings
3. Copy your API key

### 2. Configure Environment Variables

Create a `.env` file in the project root (if it doesn't exist):

```bash
VITE_ELEVENLABS_API_KEY=your_api_key_here
```

### 3. Restart Development Server

After adding the API key, restart your development server:

```bash
npm run dev
```

## Using the Script Editor

### Accessing the Script Editor

1. Navigate to the Admin Panel (typically at `/admin`)
2. Click on the "Audio Scripts" tab
3. You'll see a list of existing scripts and an editor panel

### Creating a New Script

1. Click the "+ New Script" button
2. Enter a title for your script
3. Select the script type:
   - **Voice Message**: Single-speaker announcements or messages
   - **Phone Call**: Simulated phone conversations
   - **Narration**: Story narration
   - **Dialogue**: Multi-speaker conversations
4. Optionally link to a story chapter ID

### Adding Script Lines

For each line in your script:

1. Click "+ Add Line" to create a new line
2. Enter the speaker name
3. Write the dialogue text
4. Select a voice from the dropdown (loads from ElevenLabs)
5. Click "Generate" to create the audio
6. Use the audio player to preview
7. Click "Download" to save the audio file

### Voice Settings

Each line can have custom voice settings:
- **Stability** (0-1): Lower values add more variation, higher values are more consistent
- **Similarity Boost** (0-1): How closely to match the original voice
- **Style** (0-1): How expressive the voice should be
- **Speaker Boost**: Enhanced voice clarity

Default settings are optimized for most use cases.

## Script Format

Scripts are stored in JSON format and can be exported/imported. Here's an example:

```json
{
  "id": "intro-voice-message",
  "title": "System Alert - Initial Warning",
  "description": "Opening voice message when player enters the game",
  "type": "voice-message",
  "chapterId": "intro",
  "lines": [
    {
      "id": "line-1",
      "speaker": "System AI",
      "text": "Warning. Unauthorized access detected.",
      "voiceId": "EXAVITQu4vr4xnSDxMaL",
      "order": 1,
      "settings": {
        "stability": 0.5,
        "similarityBoost": 0.75
      }
    }
  ],
  "createdAt": 1234567890,
  "updatedAt": 1234567890
}
```

## Example Scripts

The project includes several example scripts in `src/data/scripts/example-scripts.ts`:

1. **System Alert** - Initial warning message
2. **Mysterious Contact** - Phone call from an ally
3. **The Logic Labyrinth** - Narrator describing challenges
4. **Network Layer Breach** - Dialogue between system and player
5. **Freedom Achieved** - Final escape message

These examples demonstrate different script types and can be used as templates.

## Generating Audio in Bulk

To generate audio for all lines in a script:

1. Ensure all lines have a voice selected
2. Click "Generate All Audio"
3. Wait for all audio files to be generated
4. Download individual files or export the entire script

## Using Audio in Your Game

### Method 1: Direct Reference

1. Generate and download audio files
2. Place them in `public/audio/` directory
3. Reference them in your components:

```tsx
<audio src="/audio/intro-voice-message_line-1.mp3" controls />
```

### Method 2: Dynamic Loading

Use the audio URLs generated by the script editor:

```tsx
import { exampleScripts } from './data/scripts/example-scripts';

const IntroAudio = () => {
  const introScript = exampleScripts.find(s => s.id === 'intro-voice-message');
  
  return (
    <div>
      {introScript?.lines.map(line => (
        <audio key={line.id} src={line.audioUrl} controls />
      ))}
    </div>
  );
};
```

## Best Practices

### Script Writing

1. **Keep it natural**: Write dialogue as people actually speak
2. **Add pauses**: Use punctuation (periods, commas, ellipsis) for natural pacing
3. **Consider context**: Match tone and style to the game's atmosphere
4. **Test audio**: Generate and listen before finalizing

### Voice Selection

1. **Consistency**: Use the same voice for the same character throughout
2. **Contrast**: Use distinctly different voices for different characters
3. **Type matching**: 
   - Robotic voices for AI/system messages
   - Clear voices for narration
   - Varied voices for different characters

### Performance

1. **Pre-generate**: Generate audio files during development, not at runtime
2. **Optimize**: Keep script lines concise for faster generation
3. **Cache**: Store generated audio files and reuse them

## Troubleshooting

### API Key Not Working

- Verify the API key is correct
- Ensure the `.env` file is in the project root
- Restart the development server
- Check ElevenLabs account status and credits

### Voice Not Available

- Some voices may require a paid plan
- Use `fetchVoices()` to see available voices for your account
- Check the recommended voices in `src/utils/elevenlabs.ts`

### Audio Quality Issues

- Adjust stability and similarity boost settings
- Try different voices
- Break long text into shorter lines
- Remove special characters or formatting

## API Limits

ElevenLabs has usage limits based on your plan:
- Free tier: Limited characters per month
- Paid tiers: Higher limits and more voices

Monitor your usage in the ElevenLabs dashboard.

## Advanced Usage

### Custom Voice Settings

Modify settings in `src/utils/elevenlabs.ts`:

```typescript
const voiceSettings: VoiceSettings = {
  stability: 0.5,        // 0 = varied, 1 = consistent
  similarityBoost: 0.75, // 0 = creative, 1 = accurate
  style: 0,              // 0 = neutral, 1 = expressive
  useSpeakerBoost: true, // clarity enhancement
};
```

### Programmatic Generation

Generate audio programmatically:

```typescript
import { generateAudio } from './utils/elevenlabs';

const result = await generateAudio({
  text: 'Your dialogue here',
  voiceId: 'voice-id-here',
  settings: {
    stability: 0.6,
    similarityBoost: 0.8,
  }
});

if (result.success) {
  console.log('Audio URL:', result.audioUrl);
}
```

## File Organization

Suggested directory structure for audio files:

```
public/
└── audio/
    ├── intro/
    │   ├── system-alert.mp3
    │   └── welcome-message.mp3
    ├── chapter-1/
    │   ├── phone-call.mp3
    │   └── hint-voice.mp3
    └── finale/
        └── escape-success.mp3
```

## Contributing

When adding new example scripts:
1. Add them to `src/data/scripts/example-scripts.ts`
2. Follow the existing format
3. Include appropriate voice settings
4. Test audio generation
5. Document any special considerations

## Resources

- [ElevenLabs Documentation](https://docs.elevenlabs.io/)
- [Voice Settings Guide](https://docs.elevenlabs.io/api-reference/text-to-speech)
- [Available Voices](https://elevenlabs.io/voice-library)

---

For more information or issues, please refer to the main README or open an issue on GitHub.
